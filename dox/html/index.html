<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GuardMyPi: GuardMyPi</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GuardMyPi
   </div>
   <div id="projectbrief">Protecting your berries from unauthorised tampering!</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">GuardMyPi </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Introduction">Introduction</a></li>
<li class="level1"><a href="#Hardware">Required Hardware</a></li>
<li class="level1"><a href="#Build">Building OpenCV from Source</a></li>
<li class="level1"><a href="#MJPG">Streamer</a></li>
<li class="level1"><a href="#Installing">Dataplicity</a></li>
<li class="level1"><a href="#MotionDetector">MotionDetector</a></li>
<li class="level1"><a href="#ObjectDetector">ObjectDetector</a></li>
<li class="level1"><a href="#Acknowledgements">Acknowledgements</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>GuardMyPi is a home security system centred around the Raspberry Pi 3. It utilises the Pi NoIR Camera to monitor a room or entrance point in a house. Facial recognition software is used to distinguish between house members (including pets) and intruders. If an intruder is detected, a notification is sent to the user via a web application.</p>
<dl class="section author"><dt>Authors</dt><dd></dd></dl>
<p>Magnus Bell Cochran - <a href="#" onclick="location.href='mai'+'lto:'+'225'+'87'+'76B'+'@s'+'tud'+'en'+'t.g'+'la'+'.ac'+'.u'+'k'; return false;">22587<span style="display: none;">.nosp@m.</span>76B@<span style="display: none;">.nosp@m.</span>stude<span style="display: none;">.nosp@m.</span>nt.g<span style="display: none;">.nosp@m.</span>la.ac<span style="display: none;">.nosp@m.</span>.uk</a></p>
<p>Pedro Hernandez Gelado - <a href="#" onclick="location.href='mai'+'lto:'+'226'+'20'+'04h'+'@s'+'tud'+'en'+'t.g'+'la'+'.ac'+'.u'+'k'; return false;">22620<span style="display: none;">.nosp@m.</span>04h@<span style="display: none;">.nosp@m.</span>stude<span style="display: none;">.nosp@m.</span>nt.g<span style="display: none;">.nosp@m.</span>la.ac<span style="display: none;">.nosp@m.</span>.uk</a></p>
<p>Aidan Porteous - <a href="#" onclick="location.href='mai'+'lto:'+'224'+'56'+'28p'+'@s'+'tud'+'en'+'t.g'+'la'+'.ac'+'.u'+'k'; return false;">22456<span style="display: none;">.nosp@m.</span>28p@<span style="display: none;">.nosp@m.</span>stude<span style="display: none;">.nosp@m.</span>nt.g<span style="display: none;">.nosp@m.</span>la.ac<span style="display: none;">.nosp@m.</span>.uk</a></p>
<p>Project Link: <a href="https://github.com/phgelado/guardmypi">https://github.com/phgelado/guardmypi</a></p>
<h1><a class="anchor" id="Hardware"></a>
Required Hardware</h1>
<p>This project can be completed within a Â£50 budget (excluding the Raspberry Pi) with the following components:</p>
<ul>
<li>Raspberry Pi 3 <a href="https://thepihut.com/products/raspberry-pi-3-model-b-plus">https://thepihut.com/products/raspberry-pi-3-model-b-plus</a></li>
<li>Pi NoIR Camera V2 <a href="https://thepihut.com/products/raspberry-pi-noir-camera-module">https://thepihut.com/products/raspberry-pi-noir-camera-module</a></li>
<li>Infrared LED Ring <a href="https://www.amazon.co.uk/Infrared-Illuminator-Board-Security-Camera/dp/B0057DPXI4/ref=sr_1_3?dchild=1&keywords=Infrared+IR+board&qid=1614706403&sr=8-3">https://www.amazon.co.uk/Infrared-Illuminator-Board-Security-Camera/dp/B0057DPXI4/ref=sr_1_3?dchild=1&amp;keywords=Infrared+IR+board&amp;qid=1614706403&amp;sr=8-3</a></li>
<li>Raspberry Pi 3/4 and Camera enclosure <a href="https://thepihut.com/products/raspberry-pi-4-3-camera-case">https://thepihut.com/products/raspberry-pi-4-3-camera-case</a></li>
<li>MT3068 DC-DC Voltage Step Up Adjustable Boost Converter Module 2A <a href="https://www.ebay.co.uk/itm/MT3608-DC-DC-Voltage-Step-Up-Adjustable-Boost-Converter-Module-2A-UK/193424475011">https://www.ebay.co.uk/itm/MT3608-DC-DC-Voltage-Step-Up-Adjustable-Boost-Converter-Module-2A-UK/193424475011</a></li>
</ul>
<h1><a class="anchor" id="Build"></a>
Building OpenCV from Source</h1>
<ol type="1">
<li>Downloading pre-built OpenCV4 <div class="fragment"><div class="line">wget https://github.com/sol-prog/raspberry-pi-opencv/releases/download/opencv4rpi2.1/opencv-4.1.0-armhf.tar.bz2</div></div><!-- fragment --></li>
<li>Extract the archive <div class="fragment"><div class="line">tar xvf opencv-4.1.0-armhf.tar.bz2</div></div><!-- fragment --></li>
<li>Move the extracted archive to the /opt folder <div class="fragment"><div class="line">sudo mv opencv-4.1.0 /opt</div></div><!-- fragment --></li>
<li>Remove the archive (optional) <div class="fragment"><div class="line">rm opencv-4.1.0-armhf.tar.bz2</div></div><!-- fragment --></li>
<li>Install video and image support packages <div class="fragment"><div class="line">sudo apt install libjpeg-dev libtiff-dev libjasper-dev libpng-dev libwebp-dev libopenexr-dev</div><div class="line">sudo apt install libavcodec-dev libavformat-dev libswscale-dev libv4l-dev libxvidcore-dev libx264-dev libdc1394-22-dev libgstreamer-plugins-base1.0-dev libgstreamer1.0-dev</div></div><!-- fragment --></li>
<li>Install packages needed for OpenCV's interface <div class="fragment"><div class="line">sudo apt install libgtk-3-dev libqtgui4 libqtwebkit4 libqt4-test python3-pyqt5</div></div><!-- fragment --></li>
<li>Install packages for OpenCV to run at a good speed <div class="fragment"><div class="line">sudo apt install libatlas-base-dev liblapacke-dev gfortran</div></div><!-- fragment --></li>
<li>Add OpenCV to the system path <div class="fragment"><div class="line">cd ~</div><div class="line">echo &#39;export LD_LIBRARY_PATH=/opt/opencv-4.1.0/lib:$LD_LIBRARY_PATH&#39; &gt;&gt; .bashrc</div><div class="line">. .bashrc</div></div><!-- fragment --></li>
<li>Restart the terminal or log back in to the RPi if connected via SSH</li>
<li>Install git if necessary <div class="fragment"><div class="line">sudo apt-get install git</div></div><!-- fragment --></li>
<li>Clone a config file to use OpenCV for C++ <div class="fragment"><div class="line">git clone https://gist.github.com/sol-prog/ed383474872958081985de733eaf352d opencv_cpp_compile_settings</div><div class="line"> cd opencv_cpp_compile_settings/</div><div class="line"> sudo cp opencv.pc /usr/lib/arm-linux-gnueabihf/pkgconfig</div><div class="line"> cd ~</div><div class="line"> rm -rf opencv_cpp_compile_settings/</div></div><!-- fragment --></li>
<li>Check OpenCV has installed correctly on the RPi <div class="fragment"><div class="line">pkg-config --modversion opencv</div></div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="MJPG"></a>
Streamer</h1>
<ol type="1">
<li>Ensure you have CMake installed, as well as the dependencies mjpg-streamer uses: <div class="fragment"><div class="line">sudo apt-get install libjpeg8-dev imagemagick libv4l-dev</div></div><!-- fragment --></li>
<li>Clone the mjpg-streamer repository you can find here <a href="https://github.com/jacksonliam/mjpg-streamer">https://github.com/jacksonliam/mjpg-streamer</a>. <div class="fragment"><div class="line">git clone https://github.com/jacksonliam/mjpg-streamer</div></div><!-- fragment --></li>
<li>Access the mjpg-streamer directory. <div class="fragment"><div class="line">cd mjpg-streamer</div><div class="line">cd mjpg-streamer-experimental</div></div><!-- fragment --></li>
</ol>
<ol type="1">
<li>Build and install mjpg-streamer using CMake. <div class="fragment"><div class="line">make</div><div class="line">sudo make install</div></div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="Installing"></a>
Dataplicity</h1>
<p>Dataplicity is a simple to use, safe and free tool for you to access and control your RaspberryPi remotely, allowing you to setup and start your alarm from anywhere, as well as accessing the camera's live video feed.</p>
<p>Similar to a VPN, but easier to install, it also allows you to access your Pi's local port 80 (<a href="http://localhost:80">http://localhost:80</a>) through a domain, which is where the Pi's live camera feed is streamed to. Installing Dataplicity is very simple! Follow the instructions here: <a href="https://www.dataplicity.com/">https://www.dataplicity.com/</a>.</p>
<h1><a class="anchor" id="MotionDetector"></a>
MotionDetector</h1>
<p>The system has to be capable of detecting changes in individual frames. The changes in these frames are what allow computer visual applications to detect motion. However, while consecutive frames are not identical the <a class="el" href="class_motion_detector.html" title="Analyses video feed by using background subtraction with a running average to detect motion changes...">MotionDetector</a> class applies a Gaussian blur to the data to filter high frequency noise that would irregularly trigger the motion warning and the rest of the system.</p>
<p>Take a frame from a video feed of an empty room:</p>
<div class="image">
<img src="background.png" alt="background.png"/>
</div>
<p>If a person (or pet) walks into the feed, the detector will find large changes in contours by taking the absolute difference of the two frame's pixel intensities leaving only the regions containing motion:</p>
<div class="image">
<img src="frame_diff.png" alt="frame_diff.png"/>
</div>
<p>The detector acts as an event-base trigger invokes methods such as facial recognition and human detection.</p>
<div class="image">
<img src="motiondetected.png" alt="motiondetected.png"/>
</div>
<h1><a class="el" href="class_unlock.html" title="Contains various methods to unlock the system. ">Unlock</a></h1>
<p>In order to let the user unlock the system various methods were added to the <a class="el" href="class_unlock.html" title="Contains various methods to unlock the system. ">Unlock</a> class; Facial Recognition <a class="el" href="class_unlock.html#ad17e3f30373f44c62e21781ba8cddf14" title="This method takes the input frame from the camera if the time is between 8am and 9pm. ">Unlock::face()</a> and QR Detection <a class="el" href="class_unlock.html#a813735c5d1b1af7a738751963978224e" title="This method is the alternative unlocking method once it is night time. ">Unlock::QRUnlock()</a>.</p>
<h2>Facial Recognition</h2>
<p>Facial recognition is achieved using the LPBH algorithm. By using a pre-trained algorithm with faces including the desired residents. Predicting each face outputs a confidence level and ID number according to the images fed into the trained database. Including a condition with a threshold for a confidence level (currently set to 123) will allow a user to tighten or loosen the strictnes of their recognition process.</p>
<div class="image">
<img src="facerecognition.png" alt="facerecognition.png"/>
</div>
<p>After recognising the user within a specified time frame of 10s then the system is disarmed and waits for a QR code to lock and re-arm the system </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="class_unlock.html#aa4814f4d8a88b51de0431cba16e555f3" title="This method looks for another QR code whilst the system is in its unlocked state. ...">Unlock::QRLock()</a></dd></dl>
<div class="image">
<img src="facerecognised.png" alt="facerecognised.png"/>
</div>
<h2>QR Code Detection</h2>
<p>Another method that is implemented to lock and unlock the system are QR codes that can be easily generated and shown on a mobile phone. When a user would like to leave the house showing a QR Code representing "lock" will then freeze the program for 60s to allow the user to leave before the system is then re-armed.</p>
<div class="image">
<img src="qrlock.png" alt="qrlock.png"/>
</div>
<h1><a class="anchor" id="ObjectDetector"></a>
ObjectDetector</h1>
<p>The object detector is a class with methods of recognising different objects such as pets with potential to incldude methods that recognise other objects such as gestures. Currently the pet detection ObjectDector::detect attempts to recognise a grayhound, but training algorithms can be re run with a bigger database of pets.</p>
<h2>Detect</h2>
<p>Before running the human detection method, the system looks for domestic pets (if applicable) as to not send a false alarm notification to the resident(s) if their pet was captured in the frame. If a pet is detected then no flags are raised and the system continues as normal. Otherwise the human detection method is called.</p>
<div class="image">
<img src="petdetection.png" alt="petdetection.png"/>
</div>
<h1>Intruder Alert</h1>
<p>If a resident of the house is not recognised either using facial recognition nor QR Code detection, then the intruder flag is set high. This invokes both the web streaming service and email notification method, both used to capture feed of any intruder and also alert the user to notify the relevant authorities.</p>
<h1><a class="anchor" id="Acknowledgements"></a>
Acknowledgements</h1>
<ul>
<li><a href="https://github.com/othneildrew/Best-README-Template">README Template</a></li>
<li><a href="https://www.webpagefx.com/tools/emoji-cheat-sheet">GitHub Emoji Cheat Sheet</a></li>
<li><a href="https://shields.io">Img Shields</a></li>
<li><a href="https://choosealicense.com">Choose an Open Source License</a></li>
<li><a href="https://pages.github.com">GitHub Pages</a></li>
<li><a href="https://daneden.github.io/animate.css">Animate.css</a></li>
<li><a href="https://connoratherton.com/loaders">Loaders.css</a></li>
<li><a href="https://kenwheeler.github.io/slick">Slick Carousel</a></li>
<li><a href="https://github.com/cferdinandi/smooth-scroll">Smooth Scroll</a></li>
<li><a href="http://leafo.net/sticky-kit">Sticky Kit</a></li>
<li><a href="http://jvectormap.com">JVectorMap</a></li>
<li><a href="https://fontawesome.com">Font Awesome</a> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
